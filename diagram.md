# GRASP Class Diagram (Iteration 4)

Based on code analysis of `src/` directory.
Generated by Claude.

```mermaid
classDiagram
    %% Core Interfaces
    class Indexable {
        <<interface>>
        +part-at(index) Indexable
        +first-index() Index
        +last-index() Index
        +next-index(index) Index
        +previous-index(index) Index
        +index<(a, b) boolean
    }

    class Element {
        <<interface>>
        +draw!(context)
        +cursor-under*(x, y, path) Cursor
        +clone() Element
        +measure-position(cursor, target, context) Position
    }

    class Extensive {
        <<interface>>
        +extent() Extent
    }

    class Tile {
        <<interface>>
        +extent() Extent
    }

    class Shadowed {
        <<interface>>
        +value() Object
    }

    class Textual {
        <<interface>>
        +insert-char!(c, index)
        +delete-char!(index) char
        +char-ref(index) char
        +text-length() int
        +split!(position) Textual
        +merge!(following) boolean
    }

    class Interactive {
        <<interface>>
        +tap!(finger, x, y) boolean
        +press!(finger, x, y) boolean
        +scroll-up!(x, y) boolean
        +scroll-down!(x, y) boolean
        +zoom-in!(x, y) boolean
        +key-typed!(key-code, context) boolean
    }

    class Expandable {
        <<interface>>
        +expand!(traversal)
    }

    %% Inheritance relationships
    Indexable <|-- Element
    Element <|-- Tile
    Extensive <|-- Tile
    Extensive <|-- Resizable

    Tile <|-- ShadowedTile
    Shadowed <|-- ShadowedTile

    Tile <|-- TextualTile
    Textual <|-- TextualTile

    ShadowedTile <|-- ResizableShadowedTile
    Resizable <|-- ResizableShadowedTile

    TextualTile <|-- ShadowedTextualTile
    Shadowed <|-- ShadowedTextualTile

    ResizableShadowedTile <|-- MatchableResizableTile
    ShadowedTextualTile <|-- MatchableShadowedTextualTile

    %% Extension system
    class Enchanted {
        <<interface>>
    }

    Interactive <|-- Enchanted
    Tile <|-- Enchanted
    Element <|-- Enchanted

    class Magic {
        +draw!(context)
        +extent() Extent
        +tap!(finger, x, y) boolean
        +value() Object
    }

    Enchanted <|.. Magic

    class Alive {
        <<interface>>
        +advance!(timestep) boolean
    }

    Enchanted <|-- Alive

    %% Primitive types
    class Atom {
        -name: String
        +insert-char!(c, index)
        +delete-char!(index)
        +text-length() int
    }

    MatchableShadowedTextualTile <|.. Atom

    class cons {
        -car: Object
        -cdr: Object
        +part-at(index) Indexable
    }

    MatchableResizableTile <|.. cons

    %% Spaces
    class Space {
        -reach: real
    }

    Tile <|.. Space

    class LineEnding {
        -reach: real
    }

    Space <|.. LineEnding

    %% Extensions/Combinators
    class Bordered {
        -element: Enchanted
    }

    Enchanted <|.. Bordered

    class Stretched {
        -element: Enchanted
        -size: Extent
    }

    Maximizable <|.. Stretched

    class Below {
        -top: Enchanted
        -bottom: Enchanted
    }

    Enchanted <|.. Below

    class Beside {
        -left: Enchanted
        -right: Enchanted
    }

    Enchanted <|.. Beside

    class Over {
        -back: Enchanted
        -front: Enchanted
    }

    Enchanted <|.. Over

    %% Widgets
    class Button {
        -action: procedure
        -label: string
    }

    Magic <|-- Button

    class Link {
        -on-tap: procedure
        -content: Enchanted
    }

    Magic <|-- Link

    %% UI Components
    class Renderable {
        <<interface>>
        +render!()
    }

    class Pane {
        <<interface>>
    }

    Renderable <|-- Pane

    class Embeddable {
        <<interface>>
    }

    Pane <|-- Embeddable

    class Splittable {
        <<interface>>
        +split-beside!(line) Embeddable
        +split-below!(line) Embeddable
    }

    Embeddable <|-- Splittable

    class Editor {
        <<interface>>
    }

    Splittable <|-- Editor

    class Maximizable {
        <<interface>>
        +can-be-resized?() boolean
        +resize-anchor(position) ResizeAnchor
        +set-size!(width, height, anchor)
    }

    Embeddable <|-- Maximizable
    Resizable <|-- Maximizable

    %% Painting
    class Painter {
        <<interface>>
        +draw-atom!(text)
        +draw-box!(...)
        +text-extent(text) Extent
        +translate!(dx, dy)
    }

    class Extent {
        +width: real
        +height: real
    }

    class Position {
        +left: real
        +top: real
    }
```

## Key Hierarchies

### Core Element Hierarchy
- `Indexable` - provides navigation through structure
- `Element` - base for all drawable elements
- `Tile` - elements with extent (size)

### Trait Composition
- `ShadowedTile` = `Tile` + `Shadowed` (has value representation)
- `TextualTile` = `Tile` + `Textual` (editable text)
- `ShadowedTextualTile` = `Tile` + `Shadowed` + `Textual`
- `MatchableShadowedTextualTile` = above + pattern matching

### Extension System
- `Enchanted` = `Interactive` + `Tile` + `Element` - base for all extensions
- `Magic` - default implementation of `Enchanted`
- `Alive` - animated extensions

### Primitive Types
- `Atom` - text element (implements `MatchableShadowedTextualTile`)
- `cons` - pair/list element (implements `MatchableResizableTile`)
- `Space` - whitespace
- `LineEnding` - line break

### Combinators
- `Bordered` - adds border around element
- `Below`, `Beside`, `Over` - layout combinators
- `Stretched` - resizable wrapper

### UI System
- `Pane` → `Embeddable` → `Splittable` → `Editor`
- `Maximizable` - full-screen capable widgets
